#!/bin/bash
cd /work/
mkdir model
# Move model to right place
cp /opt/ml/model/model.tar.gz /work/model/model.tar.gz

# Teams can use any name of video, any type of video, so I need to know what it is somehow
cd /opt/ml/input/data/training
video=$(find -name *)
name=$(python3 /work/extension.py --file $video)
cp $video $name

# Untar model
cd /work/model
tar -xf model.tar.gz
cd ..
echo "Starting annotation of video. This will take a while. Average FPS: ~7"

# Annotate video
python3 test.py --modeldir=model --video=$name --graph=unoptimized.tflite

#Output annotated video
cp inference.avi  /opt/ml/model/output.avi
